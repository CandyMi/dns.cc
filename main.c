/* main.c */
#include "stdio.h"
#include "string.h"

#include "dns.h"

void cb(void *udata, const dns_ans_t *ans)
{
  dns_type_t  t =  dns_get_type(ans);
  const char *ip = dns_get_ip(ans);
  printf("回调: type = %d, ip = '%s', 字符串长度: %d\n", t, ip, strlen(ip));
}

int main(int argc, char const *argv[])
{
  const char resp[] = ".o\201\200\000\001\000\002\000\004\000\b\004ipv6\006google\003com\000\000\034\000\001\300\f\000\005\000\001\000\000\000i\000\t\004ipv6\001l\300\021\300-\000\034\000\001\000\000\001,\000\020$\004h\000@\005\b\021\000\000\000\000\000\000 \016\300\021\000\002\000\001\000\003\372\334\000\006\003ns2\300\021\300\021\000\002\000\001\000\003\372\334\000\006\003ns3\300\021\300\021\000\002\000\001\000\003\372\334\000\006\003ns1\300\021\300\021\000\002\000\001\000\003\372\334\000\006\003ns4\300\021\300\202\000\001\000\001\000\000\365A\000\004\330\357 \n\300\202\000\034\000\001\000\000\365A\000\020 \001H`H\002\0002\000\000\000\000\000\000\000\n\300^\000\001\000\001\000\000\365A\000\004\330\357\"\n\300^\000\034\000\001\000\000\365A\000\020 \001H`H\002\0004\000\000\000\000\000\000\000\n\300p\000\001\000\001\000\000\365A\000\004\330\357$\n\300p\000\034\000\001\000\000\365A\000\020 \001H`H\002\0006\000\000\000\000\000\000\000\n\300\224\000\001\000\001\000\000\365A\000\004\330\357&\n\300\224\000\034\000\001\000\000\365A\000\020 \001H`H\002\0008\000\000\000\000\000\000\000\n";

  dns_req_t *req = dns_new();
  dns_set_unsafe();

  char data[10086]; int r = 0;

  r = dns_query(req, A, "ipv6.google.com", data);
  printf("q r = %d\n", r);

  r = dns_parse(req, resp, NULL, cb);
  printf("r r = %d\n", r);

  dns_destory(req);
  return 0;
}
